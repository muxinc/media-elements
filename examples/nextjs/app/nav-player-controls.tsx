'use client';

import { useSearchParams, usePathname, useRouter } from 'next/navigation';

export default function NavPlayerControls() {
  const searchParams = useSearchParams();
  const isMuted = !!searchParams.get('muted');
  const hasControls = searchParams.get('controls') !== '0';
  const params = new URLSearchParams(searchParams);
  const pathname = usePathname();
  const { replace } = useRouter();

  return (
    <>
      <button
        className="mute-toggle toggle"
        onClick={() => {
          if (isMuted) {
            params.delete('muted');
          } else {
            params.set('muted', '1');
          }
          replace(`${pathname}?${params.toString()}`, { scroll: false });
        }}
        title={isMuted ? 'Unmute' : 'Mute'}
        aria-label={isMuted ? 'Unmute' : 'Mute'}
        aria-live="polite"
      >
        <svg aria-hidden="true" width="24" height="24" viewBox="0 0 24 24">
          {isMuted ? (
            // Muted icon
            <>
              <path d="M16.5 12c0-1.77-1.02-3.29-2.5-4.03v2.21l2.45 2.45c.03-.2.05-.41.05-.63zm2.5 0c0 .94-.2 1.82-.54 2.64l1.51 1.51C20.63 14.91 21 13.5 21 12c0-4.28-2.99-7.86-7-8.77v2.06c2.89.86 5 3.54 5 6.71zM4.27 3L3 4.27 7.73 9H3v6h4l5 5v-6.73l4.25 4.25c-.67.52-1.42.93-2.25 1.18v2.06c1.38-.31 2.63-.95 3.69-1.81L19.73 21 21 19.73l-9-9L4.27 3zM12 4L9.91 6.09 12 8.18V4z" />
            </>
          ) : (
            // Unmuted icon
            <>
              <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z" />
            </>
          )}
        </svg>
      </button>
      <button
        className="controls-toggle toggle"
        onClick={() => {
          if (hasControls) {
            params.set('controls', '0');
          } else {
            params.delete('controls');
          }
          replace(`${pathname}?${params.toString()}`, { scroll: false });
        }}
        title={hasControls ? 'Hide Controls' : 'Show Controls'}
        aria-label={hasControls ? 'Hide Controls' : 'Show Controls'}
        aria-live="polite"
      >
        <svg aria-hidden="true" width="24" height="24" viewBox="0 0 24 24">
          {hasControls ? (
            // Controls visible icon
            <>
              <path d="M22.266 14.724c-.064.898-.242 1.766-.522 2.586l1.601.675c-.163.461-.353.909-.568 1.344l-1.602-.676c-.383.751-.855 1.448-1.402 2.078l1.229 1.229c-.323.364-.667.709-1.032 1.032l-2.262-2.262c1.874-1.59 3.125-4.039 3.125-6.735 0-4.878-3.954-8.832-8.832-8.832s-8.833 3.954-8.833 8.832c0 2.505 1.107 5.024 3.126 6.735l-2.293 2.27-1.031-1.031 1.259-1.238c-.562-.647-1.046-1.365-1.434-2.139l-1.606.665c-.212-.436-.399-.885-.559-1.348l1.605-.664c-.268-.802-.439-1.646-.5-2.521h-1.735v-1.459h1.734c.063-.897.242-1.765.522-2.585l-1.6-.675c.163-.461.352-.91.567-1.344l1.602.675c.383-.75.855-1.448 1.403-2.078l-1.229-1.229c.323-.365.668-.709 1.032-1.031l1.229 1.229c.647-.562 1.366-1.045 2.141-1.433l-.665-1.606c.435-.212.885-.399 1.347-.558l.665 1.604c.802-.267 1.647-.438 2.522-.5v-1.734h1.459v1.733c.899.063 1.767.242 2.587.522l.675-1.6c.462.162.911.353 1.345.567l-.676 1.602c.751.383 1.449.854 2.08 1.402l1.229-1.229c.365.322.709.666 1.032 1.03l-1.229 1.229c.562.647 1.045 1.366 1.434 2.14l1.606-.665c.212.436.399.885.558 1.348l-1.604.664c.269.802.439 1.646.501 2.521h1.733v1.459h-1.734zm-3.434-.729c0 3.767-3.064 6.832-6.832 6.832s-6.833-3.065-6.833-6.832 3.065-6.832 6.833-6.832 6.832 3.065 6.832 6.832zm-7.36-1.81l-2.158-2.158-1.415 1.413 2.158 2.158 1.415-1.413z" />
            </>
          ) : (
            // Controls hidden icon
            <>
              <path d="M22.266 14.724c-.064.898-.242 1.766-.522 2.586l1.601.675c-.163.461-.353.909-.568 1.344l-1.602-.676c-.383.751-.855 1.448-1.402 2.078l1.229 1.229c-.323.364-.667.709-1.032 1.032l-2.262-2.262c1.874-1.59 3.125-4.039 3.125-6.735 0-4.878-3.954-8.832-8.832-8.832s-8.832 3.954-8.832 8.832c0 2.505 1.107 5.024 3.125 6.735l-2.292 2.27-1.032-1.031 1.259-1.238c-.562-.647-1.045-1.365-1.434-2.139l-1.605.665c-.213-.436-.4-.885-.559-1.348l1.604-.664c-.268-.802-.438-1.646-.501-2.521h-1.734v-1.459h1.734c.063-.897.242-1.765.522-2.585l-1.601-.675c.163-.461.353-.91.568-1.344l1.602.675c.383-.75.854-1.448 1.402-2.078l-1.228-1.229c.323-.365.667-.709 1.032-1.031l1.229 1.229c.648-.563 1.367-1.045 2.14-1.433l-.664-1.606c.435-.212.885-.399 1.348-.558l.664 1.604c.802-.267 1.646-.438 2.522-.5v-1.734h1.459v1.733c.899.063 1.767.242 2.587.522l.675-1.6c.462.162.911.353 1.345.567l-.676 1.602c.751.383 1.449.854 2.08 1.402l1.229-1.229c.365.322.709.666 1.032 1.03l-1.229 1.229c.562.647 1.045 1.366 1.434 2.14l1.606-.665c.212.436.399.885.558 1.348l-1.604.664c.269.802.439 1.646.501 2.521h1.733v1.459h-1.734zm-10.266-7.561c-3.768 0-6.832 3.065-6.832 6.832s3.064 6.832 6.832 6.832 6.832-3.065 6.832-6.832-3.064-6.832-6.832-6.832zm0 11.664c-2.664 0-4.832-2.167-4.832-4.832 0-.936.279-1.803.742-2.544l2.147 2.148 1.414-1.414-2.184-2.185c.775-.527 1.708-.837 2.713-.837 2.664 0 4.832 2.167 4.832 4.832s-2.168 4.832-4.832 4.832z" />
            </>
          )}
        </svg>
      </button>
    </>
  );
}
